!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):t.Gun=n()}(this,function(){"use strict";var g={};g.fns=g.fn={is:function(t){return!!t&&"function"==typeof t}},g.bi={is:function(t){return t instanceof Boolean||"boolean"==typeof t}},g.num={is:function(t){return!h(t)&&(0<=t-parseFloat(t)+1||1/0===t||-1/0===t)}},g.text={is:function(t){return"string"==typeof t}},g.text.ify=function(t){return g.text.is(t)?t:"undefined"!=typeof JSON?JSON.stringify(t):t&&t.toString?t.toString():t},g.text.random=function(t,n){var o="";for(t=t||24,n=n||"0123456789ABCDEFGHIJKLMNOPQRSTUVWXZabcdefghijklmnopqrstuvwxyz";0<t;)o+=n.charAt(Math.floor(Math.random()*n.length)),t--;return o},g.text.match=function(n,t){var o=!1;if(n=n||"",t=g.text.is(t)?{"=":t}:t||{},g.obj.has(t,"~")&&(n=n.toLowerCase(),t["="]=(t["="]||t["~"]).toLowerCase()),g.obj.has(t,"="))return n===t["="];if(g.obj.has(t,"*")){if(n.slice(0,t["*"].length)!==t["*"])return!1;o=!0,n=n.slice(t["*"].length)}if(g.obj.has(t,"!")){if(n.slice(-t["!"].length)!==t["!"])return!1;o=!0}if(g.obj.has(t,"+")&&g.list.map(g.list.is(t["+"])?t["+"]:[t["+"]],function(t){if(!(0<=n.indexOf(t)))return!0;o=!0}))return!1;if(g.obj.has(t,"-")&&g.list.map(g.list.is(t["-"])?t["-"]:[t["-"]],function(t){if(!(n.indexOf(t)<0))return!0;o=!0}))return!1;if(g.obj.has(t,">")){if(!(n>t[">"]))return!1;o=!0}if(g.obj.has(t,"<")){if(!(n<t["<"]))return!1;o=!0}if(g.obj.has(t,"?")){if(!function(t,n){for(var o,e=-1,i=0;o=n[i++];)if(!~(e=t.indexOf(o,e+1)))return!1;return!0}(n,t["?"]))return!1;o=!0}return o},g.list={is:function(t){return t instanceof Array}},g.list.slit=Array.prototype.slice,g.list.sort=function(o){return function(t,n){return t&&n?(t=t[o])<(n=n[o])?-1:n<t?1:0:0}},g.list.map=function(t,n,o){return e(t,n,o)},g.list.index=1,g.obj={is:function(t){return!!t&&(t instanceof Object&&t.constructor===Object||"Object"===Object.prototype.toString.call(t).match(/^\[object (\w+)\]$/)[1])}},g.obj.put=function(t,n,o){return(t||{})[n]=o,t},g.obj.has=function(t,n){return t&&Object.prototype.hasOwnProperty.call(t,n)},g.obj.del=function(t,n){if(t)return t[n]=null,delete t[n],t},g.obj.as=function(t,n,o,e){return t[n]=t[n]||(e===o?{}:o)},g.obj.ify=function(n){if(d(n))return n;try{n=JSON.parse(n)}catch(t){n={}}return n},function(){function o(t,n){v(this,n)&&void 0!==this[n]||(this[n]=t)}g.obj.to=function(t,n){return e(t,o,n=n||{}),n}}(),g.obj.copy=function(t){return t?JSON.parse(JSON.stringify(t)):t},function(){function o(t,n){var o=this.n;if(!o||!(n===o||d(o)&&v(o,n)))return!!n||void 0}g.obj.empty=function(t,n){return!t||!e(t,o,{n:n})}}(),function(){function c(t,n){2!==arguments.length?(c.r=c.r||[]).push(t):(c.r=c.r||{})[t]=n}var l=Object.keys;g.obj.map=function(t,n,o){var e,i,r,u,a=0,s=p(n);if(c.r=null,l&&d(t)&&(r=l(t),u=!0),h(t)||r)for(e=(r||t).length;a<e;a++){var f=a+g.list.index;if(s){if(void 0!==(i=u?n.call(o||this,t[r[a]],r[a],c):n.call(o||this,t[a],f,c)))return i}else if(n===t[u?r[a]:a])return r?r[a]:f}else for(a in t)if(s){if(v(t,a)&&void 0!==(i=o?n.call(o,t[a],a,c):n(t[a],a,c)))return i}else if(n===t[a])return a;return s?c.r:g.list.index?0:-1}}(),g.time={},g.time.is=function(t){return t?t instanceof Date:+(new Date).getTime()};var p=g.fn.is,h=g.list.is,t=g.obj,d=t.is,v=t.has,e=t.map,u=g;if("undefined"==typeof JSON)throw new Error("JSON is not included in this browser. Please load it first: ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js");var r=JSON.stringify,n=function(t,n,o,e,i){if(t<n)return{defer:!0};if(n<o)return{historical:!0};if(o<n)return{converge:!0,incoming:!0};if(n===o){if((e=r(e)||"")===(i=r(i)||""))return{state:!0};if(e<i)return{converge:!0,current:!0};if(i<e)return{converge:!0,incoming:!0}}return{err:"Invalid CRDT Data: "+e+" to "+i+" at "+n+" to "+o+"!"}},i={is:function(t){return void 0!==t&&(null===t||t!==1/0&&(!!(f(t)||o(t)||s(t))||(i.rel.is(t)||!1)))},rel:{_:"#"}};(function(){function o(t,n){return this.id?this.id=!1:n==a&&f(t)?void(this.id=t):this.id=!1}i.rel.is=function(t){if(t&&t[a]&&!t._&&l(t)){var n={};if(_(t,o,n),n.id)return n.id}return!1}})(),i.rel.ify=function(t){return b({},a,t)},u.obj.has._=".";var a=i.rel._,o=u.bi.is,s=u.num.is,f=u.text.is,c=u.obj,l=c.is,b=c.put,_=c.map,m=i,k={_:"_",soul:function(t,n){return t&&t._&&t._[n||S]}};k.soul.ify=function(t,n){return n="string"==typeof n?{soul:n}:n||{},(t=t||{})._=t._||{},t._[S]=n.soul||t._[S]||O(),t},k.soul._=m.rel._,function(){function i(t,n){if(n!==k._)return!m.is(t)||void(this.cb&&this.cb.call(this.as,t,n,this.n,this.s))}k.is=function(t,n,o){var e;return!!j(t)&&(!!(e=k.soul(t))&&!w(t,i,{as:o,cb:n,s:e,n:t}))}}(),function(){function e(t,n){var o,e=this.o;e.map?void 0===(o=e.map.call(this.as,t,""+n,e.node))?x(e.node,n):e.node&&(e.node[n]=o):m.is(t)&&(e.node[n]=t)}k.ify=function(t,n,o){return n?"string"==typeof n?n={soul:n}:n instanceof Function&&(n={map:n}):n={},n.map&&(n.node=n.map.call(o,t,void 0,n.node||{})),(n.node=k.soul.ify(n.node||{},n))&&w(t,e,{o:n,as:o}),n.node}}();var y=u.obj,j=y.is,x=y.del,w=y.map,O=u.text.random,S=k.soul._,N=k;function T(){var t;return t=J(),A<t?(F=0,A=t+T.drift):A=t+(F+=1)/P+T.drift}var J=u.time.is,A=-1/0,F=0,P=1e3,I="undefined"!=typeof performance&&(performance.timing&&performance);I&&I.timing&&I.timing.navigationStart||(I=!1);T._=">",T.drift=0,T.is=function(t,n,o){var e=n&&t&&t[B]&&t[B][T._]||o;if(e)return q(e=e[n])?e:-1/0},T.lex=function(){return T().toString(36).replace(".","")},T.ify=function(t,n,o,e,i){if(!t||!t[B]){if(!i)return;t=N.soul.ify(t,i)}var r=C(t[B],T._);return D!==n&&n!==B&&(q(o)&&(r[n]=o),D!==e&&(t[n]=e)),t},T.to=function(t,n,o){var e=t[n];return U(e)&&(e=H(e)),T.ify(o,n,T.is(t,n),e,N.soul(t))},function(){function a(t,n){B!==n&&T.ify(this.o,n,this.s)}T.map=function(i,r,u){var t=U(t=i||r)?t:null;return i=L(i=i||r)?i:null,t&&!i?(r=q(r)?r:T(),t[B]=t[B]||{},G(t,a,{o:t,s:r}),t):(u=u||U(r)?r:void 0,r=q(r)?r:T(),function(t,n,o,e){if(!i)return a.call({o:o,s:r},t,n),t;i.call(u||this||{},t,n,o,e),E(o,n)&&void 0===o[n]||a.call({o:o,s:r},t,n)})}}();var D,M=u.obj,C=M.as,E=M.has,U=M.is,G=M.map,H=M.copy,q=u.num.is,L=u.fn.is,B=N._,K=T,R={};!function(){function i(t,n){if(!t||n!==N.soul(t)||!N.is(t,this.fn,this.as))return!0;this.cb&&(o.n=t,o.as=this.as,this.cb.call(o.as,t,n,o))}function o(t){t&&N.is(o.n,t,o.as)}R.is=function(t,n,o,e){return!(!t||!z(t)||W(t))&&!Z(t,i,{cb:n,fn:o,as:e})}}(),function(){function a(t,n){var o;return(o=function(t,n){var o,e=t.seen,i=e.length;for(;i--;)if(o=e[i],n.obj===o.obj)return o;e.push(n)}(t,n))?o:(n.env=t,n.soul=i,N.ify(n.obj,e,n)&&(t.graph[m.rel.is(n.rel)]=n.node),n)}function e(t,n,o){var e,i,r=this,u=r.env;if(N._===n&&V(t,m.rel._))return o._;if(e=s(t,n,o,r,u)){if(n||(r.node=r.node||o||{},V(t,N._)&&(r.node._=Y(t._)),r.node=N.soul.ify(r.node,m.rel.is(r.rel)),r.rel=r.rel||m.rel.ify(N.soul(r.node))),(i=u.map)&&(i.call(u.as||{},t,n,o,r),V(o,n))){if(void 0===(t=o[n]))return void Q(o,n);if(!(e=s(t,n,o,r,u)))return}if(!n)return r.node;if(!0===e)return t;if((i=a(u,{obj:t,path:r.path.concat(n)})).node)return i.rel}}function i(t){var n=this,o=m.rel.is(n.rel),e=n.env.graph;n.rel=n.rel||m.rel.ify(t),n.rel[m.rel._]=t,n.node&&n.node[N._]&&(n.node[N._][m.rel._]=t),V(e,o)&&(e[t]=e[o],Q(e,o))}function s(t,n,o,e,i){var r;return!!m.is(t)||(z(t)?1:(r=i.invalid)?s(t=r.call(i.as||{},t,n,o),n,o,e,i):(i.err="Invalid value at '"+e.path.concat(n).join(".")+"'!",void(u.list.is(t)&&(i.err+=" Use `.set(item)` instead of an Array."))))}R.ify=function(t,n,o){var e={path:[],obj:t};return n?"string"==typeof n?n={soul:n}:n instanceof Function&&(n.map=n):n={},n.soul&&(e.rel=m.rel.ify(n.soul)),n.graph=n.graph||{},n.seen=n.seen||[],n.as=n.as||o,a(n,e),n.root=e.node,n.graph}}(),R.node=function(t){var n=N.soul(t);if(n)return X({},n,t)},function(){function i(t,n){var o,e;if(N._!==n)(o=m.rel.is(t))?(e=this.opt.seen[o])?this.obj[n]=e:this.obj[n]=this.opt.seen[o]=R.to(this.graph,o,this.opt):this.obj[n]=t;else{if(W(t,m.rel._))return;this.obj[n]=Y(t)}}R.to=function(t,n,o){if(t){var e={};return o=o||{seen:{}},Z(t[n],i,{obj:e,graph:t,opt:o}),e}}}();u.fn.is;var $=u.obj,z=$.is,Q=$.del,V=$.has,W=$.empty,X=$.put,Z=$.map,Y=$.copy,tt=R;var nt=u.time.is,ot=function(e){var i={s:{}};return e=e||{max:1e3,age:9e3},i.check=function(t){var n;return!!(n=i.s[t])&&(n.pass?n.pass=!1:i.track(t))},i.track=function(t,n){var o=i.s[t]||(i.s[t]={});return o.was=nt(),n&&(o.pass=!0),i.to||(i.to=setTimeout(function(){var o=nt();u.obj.map(i.s,function(t,n){e.age>o-t.was||u.obj.del(i.s,n)}),i.to=null},e.age+9)),o},i};function et(t){return t instanceof et?(this._={gun:this}).gun:this instanceof et?et.create(this._={gun:this,opt:t}):new et(t)}et.is=function(t){return t instanceof et||t&&t._&&t._.gun&&!0||!1},et.version=.9,(et.chain=et.prototype).toJSON=function(){},u.obj.to(u,et),et.HAM=n,et.val=m,et.node=N,et.state=K,et.graph=tt,et.on=function t(n,o,e){if(!n)return{to:t};n=(this.tag||(this.tag={}))[n]||(this.tag[n]={tag:n,to:t._={next:function(t){var n;(n=this.to)&&n.next(t)}}});if(o instanceof Function){var i={off:t.off||(t.off=function(){if(this.next===t._.next)return!0;this===this.the.last&&(this.the.last=this.back),this.to.back=this.back,this.next=t._.next,this.back.to=this.to,this.the.last===this.the&&delete this.on.tag[this.the.tag]}),to:t._,next:o,the:n,on:this,as:e};return(i.back=n.last||n).to=i,n.last=i}return(n=n.to)&&void 0!==o&&n.next(o),n},et.ask=function(t,n){if(this.on){if(!(t instanceof Function)){if(!t||!n)return;var o=t["#"]||t,e=(this.tag||empty)[o];if(!e)return;return e=this.on(o,n),clearTimeout(e.err),!0}if(o=n&&n["#"]||Math.random().toString(36).slice(2),!t)return o;var i=this.on(o,t,n);return i.err=i.err||setTimeout(function(){i.next({err:"Error: No ACK received yet."}),i.off()},(this.opt||{}).lack||9e3),o}},et.dup=ot,function(){function r(t){var n,o,e=this.as,i=e.gun;(o=t["#"])||(o=t["#"]=at(9)),(n=e.dup).check(o)?e.out===t.out&&(t.out=void 0,this.to.next(t)):(n.track(o),e.ask(t["@"],t)||(t.get&&et.on.get(t,i),t.put&&et.on.put(t,i)),this.to.next(t),e.out||(t.out=r,e.on("out",t)))}et.create=function(t){t.root=t.root||t,t.graph=t.graph||{},t.on=t.on||et.on,t.ask=t.ask||et.ask,t.dup=t.dup||et.dup();var n=t.gun.opt(t.opt);return t.once||(t.on("in",r,t),t.on("out",r,lt(t,{out:r})),et.on("create",t),t.on("create",t)),t.once=1,n}}(),function(){function i(t,n,o,e){var i=this,r=et.state.is(o,n);if(!r)return i.err="Error: No state on '"+n+"' in node '"+e+"'!";var u=i.graph[e]||vt,a=et.state.is(u,n,!0),s=u[n],f=et.HAM(i.machine,r,a,t,s);f.incoming?(i.put[e]=et.state.to(o,n,i.put[e]),(i.diff||(i.diff={}))[e]=et.state.to(o,n,i.diff[e]),i.souls[e]=!0):f.defer&&(i.defer=r<(i.defer||1/0)?r:i.defer)}function r(t,n){var o=this,e=o.gun._,i=(e.next||vt)[n];if(!i){if(!(e.opt||vt).super)return void(o.souls[n]=!1);i=o.gun.get(n)._}var r=o.map[n]={put:t,get:n,gun:i.gun},u={ctx:o,msg:r};o.async=!!e.tag.node,o.ack&&(r["@"]=o.ack),gt(t,a,u),o.async&&(o.and||e.on("node",function(t){this.to.next(t),t===o.map[t.get]&&(o.souls[t.get]=!1,gt(t.put,s,t),gt(o.souls,function(t){if(t)return t})||o.c||(o.c=1,this.off(),e.stop={},gt(o.map,f,o)))}),o.and=!0,e.on("node",r))}function a(t,n){var o=this.ctx,e=o.graph,i=this.msg,r=i.get,u=i.put,a=i.gun._;e[r]=et.state.to(u,n,e[r]),o.async||(a.put=et.state.to(u,n,a.put))}function s(t,n){var o=this.put,e=this.gun._;e.put=et.state.to(o,n,e.put)}function f(t,n){t.gun&&t.gun._.on("in",t)}et.on.put=function(t,n){var o=n._,e={gun:n,graph:o.graph,put:{},map:{},souls:{},machine:et.state(),ack:t["@"]};if(et.graph.is(t.put,null,i,e)||(e.err="Error: Invalid graph!"),e.err)return o.on("in",{"@":t["#"],err:et.log(e.err)});gt(e.put,r,e),e.async||(o.stop={},gt(e.map,f,e)),void 0!==e.defer&&setTimeout(function(){et.on.put(t,n)},e.defer-e.machine),e.diff&&o.on("put",lt(t,{put:e.diff}))},et.on.get=function(t,n){var o=n._,e=t.get[ht],i=o.graph[e],r=t.get[dt],u=(o.next||(o.next={}))[e];if(!i||!u)return o.on("get",t);if(r){if(!ct(i,r))return o.on("get",t);i=et.state.to(i,r)}else i=et.obj.copy(i);i=et.graph.node(i),o.on("in",{"@":t["#"],how:"mem",put:i,gun:n}),o.on("get",t)}}(),et.chain.opt=function(t){t=t||{};var n=this._,o=t.peers||t;return ft(t)||(t={}),ft(n.opt)||(n.opt=t),ut(o)&&(o=[o]),it(o)&&(o=gt(o,function(t,n,o){o(t,{url:t})}),ft(n.opt.peers)||(n.opt.peers={}),n.opt.peers=lt(o,n.opt.peers)),n.opt.peers=n.opt.peers||{},lt(t,n.opt),et.on("opt",n),n.opt.uuid=n.opt.uuid||function(){return pt()+at(12)},this};var it=et.list.is,rt=et.text,ut=rt.is,at=rt.random,st=et.obj,ft=st.is,ct=st.has,lt=st.to,gt=st.map,pt=(st.copy,et.state.lex),ht=et.val.rel._,dt=".",vt=(et.node._,et.val.rel.is,{});console.debug=function(t,n){return console.debug.i&&t===console.debug.i&&console.debug.i++&&(console.log.apply(console,arguments)||n)},(et.log=function(){return!et.log.off&&console.log.apply(console,arguments),[].slice.call(arguments).join(" ")}).once=function(t,n,o){return(o=et.log.once)[t]=o[t]||0,o[t]++||et.log(n)},et.log.once("welcome","Hello wonderful person! :) Thanks for using GUN, feel free to ask for help on https://gitter.im/amark/gun and ask StackOverflow questions tagged with 'gun'!"),"undefined"!=typeof window&&(window.Gun=et);try{"undefined"!=typeof common&&(common.exports=et)}catch(t){}var bt=et;function _t(t){var n,o=this.as,e=o.back,i=o.root;if(t.I||(t.I=o.gun),t.gun||(t.gun=o.gun),this.to.next(t),n=t.get){if(n["#"]||o.soul){if(n["#"]=n["#"]||o.soul,t["#"]||(t["#"]=It(9)),e=i.gun.get(n["#"])._,n=n["."]){if(Jt(e.put,n))return void e.on("in",{gun:e.gun,put:bt.state.to(e.put,n),get:e.get})}else{if(Jt(e,"put")&&e.on("in",e),e.ack)return;t.gun=e.gun,e.ack=-1}return i.ask(Ot,t),i.on("in",t)}if(i.now&&(i.now[o.id]=i.now[o.id]||!0),n["."])return o.get?(t={get:{".":o.get},gun:o.gun},(e.ask||(e.ask={}))[o.get]=t.gun._):t={get:{},gun:o.gun},e.on("out",t);if(o.ack=o.ack||-1,o.get)return t.gun=o.gun,n["."]=o.get,(e.ask||(e.ask={}))[o.get]=t.gun._,e.on("out",t)}return e.on("out",t)}function mt(t){var n,o=this,e=this.as,i=t.gun._,r=t.put;if(e.get&&t.get!==e.get&&(t=Ft(t,{get:e.get})),e.has&&i!==e&&(t=Ft(t,{gun:e.gun}),i.ack&&(e.ack=i.ack)),Mt===e.get&&r&&r["#"]&&(e._id=r["#"]),St===r){if(o.to.next(t),e.soul)return;return yt(e,t,o),e.has&&wt(e,t),At(i.echo,e.id),void At(e.map,i.id)}return e.soul?(o.to.next(t),yt(e,t,o),void Pt(r,xt,{at:t,cat:e})):(n=bt.val.rel.is(r))?(kt(e,t,i,n),o.to.next(t),void yt(e,t,o)):bt.val.is(r)?(e.has||e.soul?wt(e,t):(i.has||i.soul)&&((((i.echo||(i.echo={}))[e.id]=e).map||(e.map={}))[i.id]=e.map[i.id]||{at:i}),o.to.next(t),void yt(e,t,o)):(e.has&&i!==e&&Jt(i,"put")&&(e.put=i.put),(n=bt.node.soul(r))&&i.has&&(i.put=e.root.gun.get(n)._.put),o.to.next(t),yt(e,t,o),kt(e,t,i,n),void Pt(r,xt,{at:t,cat:e}))}function kt(t,n,o,e){if(e&&Mt!==t.get){var i=t.root.gun.get(e)._;if(t.has?o=i:o.has&&kt(o,n,o,e),o!==t){((o.echo||(o.echo={}))[t.id]=t).has&&!(t.map||Nt)[o.id]&&wt(t,n),i=(t.map||(t.map={}))[o.id]=t.map[o.id]||{at:o};var r=t.root.now;if(e===i.rel){if(!r)return;if(St===r[t.id])return;if((r._||(r._={}))[t.id]===e)return;r._[t.id]=e}!function(t,o){var n=t.root.gun.get(o)._;if(t.ack&&(n.on("out",{get:{"#":o}}),!t.ask))return;Pt(t.ask||t.next,function(t,n){t.on("out",{get:{"#":o,".":n}})}),bt.obj.del(t,"ask")}(t,i.rel=e)}}}function yt(t,n,o){t.echo&&(t.has&&(n=Ft(n,{event:o})),Pt(t.echo,jt,n))}function jt(t){t.on("in",this)}function xt(t,n){var o,e,i=this.cat.next||Nt,r=this.at;(Mt!==n||i[n])&&(e=i[n])&&(e.has?(t&&t[Dt]&&bt.val.rel.is(t)===bt.node.soul(e.put)||(e.put=t),o=e.gun):o=r.gun.get(n),e.on("in",{put:t,get:n,gun:o,via:r}))}function wt(n,t){if(n.has||n.soul){var o=n.map,e=n.root;n.map=null,(e.now&&e.now[n.id]||t["@"]||null!==o)&&(St===o&&bt.val.rel.is(n.put)||(Pt(o,function(t){(t=t.at)&&At(t.echo,n.id)}),Pt(n.next,function(t,n){t.put=St,t.ack&&(t.ack=-1),t.on("in",{get:n,gun:t.gun,put:St})})))}}function Ot(t,n){var o=this.as,e=o.get||Nt,i=o.gun._,r=(t.put||Nt)[e["#"]];if(i.ack&&(i.ack=i.ack+1||1),!t.put||e["."]&&!Jt(r,i.get)){if(i.put!==St)return;i.on("in",{get:i.get,put:i.put=St,gun:i.gun,"@":t["@"]})}else Mt!=e["."]?(t.gun=i.root.gun,bt.on.put(t,i.root.gun)):i.on("in",{get:i.get,put:r[i.get],gun:i.gun,"@":t["@"]})}bt.chain.chain=function(t){var n,o=this._,e=new(t||this).constructor(this),i=e._;return i.root=n=o.root,i.id=++n.once,i.back=this._,i.on=bt.on,i.on("in",mt,i),i.on("out",_t,i),e};var St,Nt={},Tt=bt.obj,Jt=Tt.has,At=(Tt.put,Tt.del),Ft=Tt.to,Pt=Tt.map,It=bt.text.random,Dt=bt.val.rel._,Mt=bt.node._;bt.chain.back=function(t,n){if(-1===(t=t||1)||1/0===t)return this._.root.gun;if(1===t)return(this._.back||this._).gun;var o=this._;if("string"==typeof t&&(t=t.split(".")),t instanceof Array){for(var e=0,i=t.length,r=o;e<i;e++)r=(r||Ct)[t[e]];return void 0!==r?n?this:r:(r=o.back)?r.gun.back(t,n):void 0}if(t instanceof Function){var u;for(r={back:o};(r=r.back)&&!(u=t(r,n)););return u}return bt.num.is(t)?(o.back||o).gun.back(t-1):this};var Ct={};function Et(t){t&&t()}function Ut(){var i=this;i.graph&&!zt(i.stun,Gt)&&(i.res=i.res||function(t){t&&t()},i.res(function(){var n=i.gun.back(-1)._,t=n.ask(function(t){n.root.on("ack",t),this.off(),i.ack&&i.ack(t,this)},i.opt),o=n.root.now;Kt.del(n.root,"now"),n.root.PUT=!0;var e=n.root.stop;i.ref._.now=!0,i.ref._.on("out",{gun:i.ref,put:i.out=i.env.graph,opt:i.opt,"#":t}),Kt.del(i.ref._,"now"),Kt.del(n.root,"PUT"),n.root.now=o,n.root.stop=e},i),i.res&&i.res())}function Gt(t,n){if(t)return!0}function Ht(t,n,o,r){var u=this;!n&&r.path.length&&(u.res||Wt)(function(){for(var o=r.path,e=u.ref,t=(u.opt,0),n=o.length;t<n;t++)e=e.get(o[t]);if(bt.node.soul(r.obj)){var i=bt.node.soul(r.obj)||(u.via.back("opt.uuid")||bt.text.random)();return i?(e.back(-1).get(i),void r.soul(i)):((u.stun=u.stun||{})[o]=!0,void u.via.back("opt.uuid")(function(t,n){if(t)return bt.log(t);e.back(-1).get(n),r.soul(n),u.stun[o]=!1,u.batch()}))}(u.stun=u.stun||{})[o]=!0,e.get("_").get(qt,{as:{at:r,as:u}})},{as:u,at:r})}function qt(t,n){var o=this.as,e=o.at;if(o=o.as,t.gun&&t.gun._.back){var i=t.gun._,r=i,u=(t.put||Qt)["#"];n.off(),i=t.gun._.back;var a=a||bt.node.soul(e.obj)||bt.node.soul(i.put)||bt.val.rel.is(i.put)||u||r._id||(o.via.back("opt.uuid")||bt.text.random)();a?Lt(i,r._id=r._id||a,e,o):i.via.back("opt.uuid")(function(t,n){if(t)return bt.log(t);Lt(i,r._id=r._id||n,e,o)})}}function Lt(t,n,o,e){t.gun.back(-1).get(n),o.soul(n),e.stun[o.path]=!1,e.batch()}function Bt(t,n){var o=this.as;if(t.gun&&t.gun._)if(t.err)console.log("Please report this as an issue! Put.any.err");else{var e,i=t.gun._.back,r=i.put,u=o.opt||{};if(!(e=o.ref)||!e._.now){if(n.off(),o.ref!==o.gun){if(!(e=o.gun._.get||i.get))return void console.log("Please report this as an issue! Put.no.get");o.data=$t({},e,o.data),e=null}if(void 0===r){if(!i.get)return;i.soul||(e=i.gun.back(function(t){if(t.soul)return t.soul;o.data=$t({},t.get,o.data)})),e=e||i.get,i=i.root.gun.get(e)._,o.not=o.soul=e,r=o.data}o.not||(o.soul=bt.node.soul(r))||(o.path&&Rt(o.data)?o.soul=(u.uuid||o.via.back("opt.uuid")||bt.text.random)():(Xt==t.get&&(o.soul=(t.put||Qt)["#"]||t._id),o.soul=o.soul||t.soul||i.soul||(u.uuid||o.via.back("opt.uuid")||bt.text.random)()),o.soul)?o.ref.put(o.data,o.soul,o):o.via.back("opt.uuid")(function(t,n){if(t)return bt.log(t);o.ref.put(o.data,o.soul=n,o)})}}}bt.chain.put=function(t,e,i){var n,r=this,o=r._,u=o.root.gun;return(i=i||{}).data=t,i.via=i.gun=i.via||i.gun||r,"string"==typeof e?i.soul=e:i.ack=i.ack||e,o.soul&&(i.soul=o.soul),i.soul||u===r?Rt(i.data)?(i.soul=i.soul||(i.not=bt.node.soul(i.data)||(i.via.back("opt.uuid")||bt.text.random)()),i.soul?(i.gun=r=u.get(i.soul),i.ref=i.gun,function(t){t.batch=Ut;var n=t.opt||{},o=t.env=bt.state.map(Ht,n.state);if(o.soul=t.soul,t.graph=bt.graph.ify(t.data,o,t),o.err)return(t.ack||Vt).call(t,t.out={err:bt.log(o.err)}),t.res&&t.res();t.batch()}(i)):i.via.back("opt.uuid")(function(t,n){if(t)return bt.log(t);(i.ref||i.gun).put(i.data,i.soul=n,i)}),r):((i.ack||Vt).call(i,i.out={err:bt.log("Data saved to the root level of the graph must be a node (an object), not a",typeof i.data,'of "'+i.data+'"!')}),i.res&&i.res(),r):bt.is(t)?(t.get("_").get(function(t,n,o){if(n.off(),!(o=t.gun)||!(o=o._.back)||!o.soul)return bt.log("The reference you are saving is a",typeof t.put,'"'+i.put+'", not a node (object)!');r.put(bt.val.rel.ify(o.soul),e,i)}),r):(i.ref=i.ref||u._===(n=o.back)?r:n.gun,i.ref._.soul&&bt.val.is(i.data)&&o.get?(i.data=$t({},o.get,i.data),i.ref.put(i.data,i.soul,i)):(i.ref.get("_").get(Bt,{as:i}),i.out||(i.res=i.res||Et,i.gun._.stun=i.ref._.stun)),r)};var Kt=bt.obj,Rt=Kt.is,$t=Kt.put,zt=Kt.map,Qt={},Vt=function(){},Wt=function(t,n){t.call(n||Qt)},Xt=bt.node._;function Zt(t){var n,o=this,e=o.as,i=t.gun._,r=i.root,u=t.put;if((n=r.now)&&o!==n[e.now])return o.to.next(t);void 0===u&&(u=i.put),(n=u)&&n[nn._]&&(n=nn.is(n))&&void 0!==(n=i.root.gun.get(n)._).put&&(t=Yt(t,{put:n.put})),e.use(t,t.event||o),o.to.next(t)}bt.chain.get=function(t,n,o){var e;if("string"!=typeof t){if(t instanceof Function){var i,r=(e=this)._,u=r.root,a=u.now;return(o=n||{}).use=t,o.out=o.out||{},o.out.get=o.out.get||{},i=r.on("in",Zt,o),(u.now={$:1})[o.now=r.id]=i,r.on("out",o.out),u.now=a,e}return tn(t)?this.get(""+t,n,o):(a=nn.is(t))?this.get(a,n,o):((o=this.chain())._.err={err:bt.log("Invalid get request!",t)},n&&n.call(o,o._.err),o)}var s=this._;return(e=(s.next||on)[t])||(e=function(t,n){var o=n._,e=o.next,i=n.chain()._;e||(e=o.next={});e[i.get=t]=i,n===o.root.gun?i.soul=t:(o.soul||o.has)&&(i.has=t);return i}(t,this)),e=e.gun,(a=s.stun)&&(e._.stun=e._.stun||a),n&&n instanceof Function&&e.get(n,o),e};bt.obj.has;var Yt=bt.obj.to,tn=bt.num.is,nn=bt.val.rel,on=(bt.node._,{});return bt});